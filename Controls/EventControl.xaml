<UserControl x:Class="OutlookCalendar.Controls.EventControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:models="clr-namespace:OutlookCalendar.Models"
             mc:Ignorable="d" 
             d:DesignHeight="80" d:DesignWidth="150">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/CalendarStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Border x:Name="EventBorder"
            Style="{StaticResource CalendarEventStyle}"
            Background="{Binding Category, Converter={StaticResource CategoryToBackgroundConverter}}"
            BorderBrush="{Binding Category, Converter={StaticResource CategoryToBackgroundConverter}}"
            MouseLeftButtonDown="EventBorder_MouseLeftButtonDown"
            MouseLeftButtonUp="EventBorder_MouseLeftButtonUp"
            MouseMove="EventBorder_MouseMove"
            ToolTipService.ShowDuration="10000">
        
        <Border.ToolTip>
            <ToolTip MaxWidth="300">
                <StackPanel>
                    <TextBlock Text="{Binding Title}" FontWeight="Bold" TextWrapping="Wrap"/>
                    <TextBlock Margin="0,4,0,0">
                        <Run Text="{Binding StartTime, StringFormat='{}{0:HH:mm}'}"/>
                        <Run Text=" – "/>
                        <Run Text="{Binding EndTime, StringFormat='{}{0:HH:mm}'}"/>
                    </TextBlock>
                    <TextBlock Text="{Binding Location}" 
                               Margin="0,4,0,0" 
                               Visibility="{Binding Location, Converter={StaticResource BoolToVisibilityConverter}}"
                               FontStyle="Italic"/>
                    <TextBlock Text="{Binding Description}" 
                               Margin="0,4,0,0" 
                               TextWrapping="Wrap"
                               Visibility="{Binding Description, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>
            </ToolTip>
        </Border.ToolTip>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Заголовок события -->
            <TextBlock Grid.Row="0"
                       Text="{Binding Title}"
                       Foreground="{Binding Category, Converter={StaticResource CategoryToForegroundConverter}}"
                       FontWeight="SemiBold"
                       FontSize="11"
                       TextTrimming="CharacterEllipsis"
                       TextWrapping="Wrap"
                       MaxHeight="36"/>
            
            <!-- Время и локация -->
            <StackPanel Grid.Row="1" Margin="0,2,0,0">
                <TextBlock Foreground="{Binding Category, Converter={StaticResource CategoryToForegroundConverter}}"
                           FontSize="10"
                           Opacity="0.8">
                    <Run Text="{Binding StartTime, StringFormat='{}{0:HH:mm}'}"/>
                    <Run Text=" – "/>
                    <Run Text="{Binding EndTime, StringFormat='{}{0:HH:mm}'}"/>
                </TextBlock>
                
                <TextBlock Text="{Binding Location}"
                           Foreground="{Binding Category, Converter={StaticResource CategoryToForegroundConverter}}"
                           FontSize="10"
                           FontStyle="Italic"
                           Opacity="0.7"
                           TextTrimming="CharacterEllipsis"
                           Visibility="{Binding Location.Length, Converter={StaticResource BoolToVisibilityConverter}}"/>
            </StackPanel>
            
            <!-- Индикатор высокого приоритета -->
            <Border Grid.Row="0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Visibility="{Binding IsHighPriority, Converter={StaticResource BoolToVisibilityConverter}}"
                    Background="Red"
                    CornerRadius="2"
                    Padding="2,1"
                    Margin="0,-2,-2,0">
                <TextBlock Text="!" 
                           Foreground="White" 
                           FontWeight="Bold" 
                           FontSize="9"/>
            </Border>
        </Grid>
    </Border>
</UserControl>
